{% extends "base.html" %}
{% load static %}

{% block title %}Calendar - Owlery Management{% endblock %}

{% block content %}
<style>
    /* --- FULLCALENDAR DARK THEME OVERRIDES --- */
    #calendar {
        background-color: var(--bg-card); /* Dark Card BG */
        color: var(--text-main);
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
    }

    /* Toolbar Title */
    .fc .fc-toolbar-title {
        color: var(--text-main);
        font-weight: 700;
    }

    /* --- THE FIX: HEADERS & GRID --- */
    
    /* Force Header Backgrounds to be Dark (Fixes the white bar) */
    .fc-theme-standard th, 
    .fc-scrollgrid-section-header > *,
    .fc-col-header-cell {
        background-color: var(--bg-card) !important; /* Matches Card */
        border-color: var(--border-color) !important;
        color: var(--text-main) !important;
    }

    /* Fix the Header Text Color (e.g. "Saturday") */
    .fc-col-header-cell-cushion {
        color: var(--text-main) !important; /* White text */
        text-decoration: none !important;
        padding: 10px 0;
        font-weight: 600;
    }
    .fc-col-header-cell-cushion:hover {
        color: var(--primary) !important;
    }
    
    /* Top Left Corner (Time Grid Axis) */
    .fc-timegrid-axis-cushion,
    .fc-timegrid-axis {
        background-color: var(--bg-card) !important;
        color: var(--text-muted) !important;
    }

    /* Borders for the whole grid */
    .fc-theme-standard td, 
    .fc-theme-standard .fc-scrollgrid,
    .fc-scrollgrid-section > * {
        border-color: var(--border-color) !important;
    }

    /* Time Axis (Left Side 12am, 1am...) */
    .fc .fc-timegrid-slot-label-cushion {
        color: var(--text-muted);
    }
    .fc .fc-timegrid-slot {
        border-bottom: 1px solid var(--border-color); /* Subtle lines */
    }

    /* Day Numbers (in Month View) */
    .fc .fc-daygrid-day-number {
        color: var(--text-main);
        text-decoration: none;
        padding: 8px;
    }

    /* Buttons (Today, Prev, Next) */
    .fc .fc-button-primary {
        background-color: var(--bg-input);
        border-color: var(--border-color);
        color: var(--text-main);
        font-weight: 500;
        text-transform: capitalize;
        transition: all 0.2s;
    }
    .fc .fc-button-primary:hover {
        background-color: var(--primary);
        border-color: var(--primary);
        color: white;
    }
    .fc .fc-button-primary:disabled {
        background-color: var(--bg-body);
        border-color: var(--border-color);
        opacity: 0.6;
    }

    /* Active View Button (Month/Week/Day) */
    .fc .fc-button-primary:not(:disabled).fc-button-active {
        background-color: var(--primary);
        border-color: var(--primary);
        color: white;
    }

    /* Events */
    .fc-event {
        cursor: pointer;
        border: none;
        padding: 2px 4px;
        font-size: 0.85rem;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* Today Highlight */
    .fc .fc-day-today {
        background-color: rgba(59, 130, 246, 0.08) !important; /* Very subtle blue tint */
    }
</style>

{# --- Calendar Section --- #}
<section class="mb-5">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="page-title fw-bold">Calendar</h2>
            <div>
                <a href="{% url 'users:dashboard' %}" class="btn btn-outline-secondary me-2 text-white border-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                </a>
                <a href="{% url 'cases:create-meeting' %}" class="btn btn-primary-action">
                    <i class="fas fa-plus me-2"></i>Schedule Meeting
                </a>
            </div>
        </div>

        <div id="calendar"></div>
    </div>
</section>

<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      themeSystem: 'standard',
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
      },
      events: '/cases/api/calendar-events/', // Your events API endpoint
      eventColor: '#3b82f6', // Default event color (Primary Blue)
      eventTextColor: '#ffffff',
      height: 'auto',
      
      // Navigate to event on click
      eventClick: function(info) {
        if (info.event.url) {
            window.location.href = info.event.url;
            info.jsEvent.preventDefault();
        }
      }
    });
    calendar.render();
  });
</script>
{% endblock %}