{% extends "base.html" %}
{% load static %}

{% block title %}Calendar - Owlery Management{% endblock %}

{% block content %}
{# --- Calendar Section (For Both Attorneys and Clients) --- #}
  <section class="mb-5">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-3"> 
          <h2 class="page-title">Calendar</h2>
          <div>
            <a href="{% url 'users:dashboard' %}" class="btn btn-secondary me-2">‚Üê Back to Cases</a>    
         <a href="{% url 'cases:create-meeting' %}"  class="btn btn-primary-action">+ Schedule Meeting</a>
        </div>
      </div>
      <div id="calendar" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);"></div>
    </div>
  </section>

  <!-- FullCalendar CSS -->
  <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css' rel='stylesheet' />

  <style>
    #calendar {
      max-width: 1000px;
      margin: 20px auto;
    }
    
    .fc {
      font-family: inherit;
    }
    
    .fc-button-primary {
      background-color: #c4a24c !important;
      border-color: #c4a24c !important;
    }
    
    .fc-button-primary:hover {
      background-color: #a68839 !important;
    }
    
    .fc-daygrid-day.fc-day-today {
      background-color: rgba(196, 162, 76, 0.1) !important;
    }
  </style>

  <!-- FullCalendar JavaScript -->
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var calendarEl = document.getElementById('calendar');
      var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        events: '/cases/api/calendar-events/',
        height: 'auto',
        contentHeight: 'auto',
        // NEW: Handle event clicks
        eventClick: function(info) {
          var event = info.event;
          var props = event.extendedProps;
          
          // Populate modal with event data
          document.getElementById('modalMeetingTitle').textContent = event.title;
          document.getElementById('modalCaseTitle').textContent = 'Case: ' + props.caseTitle;
          document.getElementById('modalScheduledTime').textContent = 'Scheduled: ' + props.scheduledTime;
          document.getElementById('modalMeetingType').textContent = 'Type: ' + props.meetingType;
          document.getElementById('modalDuration').textContent = 'Duration: ' + props.duration + ' minutes';
          document.getElementById('modalDescription').textContent = props.description;
          document.getElementById('modalOrganizer').textContent = 'Organized by: ' + props.organizer;
          document.getElementById('modalParticipants').textContent = 'Participants: ' + props.participants;
          
          // Show the modal
          var modal = new bootstrap.Modal(document.getElementById('meetingDetailsModal'));
          modal.show();
        }
      });
      calendar.render();
    });
  </script>

  <!-- Meeting Details Modal -->
  <div class="modal fade" id="meetingDetailsModal" tabindex="-1" aria-labelledby="meetingDetailsLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header" style="background-color: #c4a24c; color: white;">
          <h5 class="modal-title" id="meetingDetailsLabel">üìû Meeting Details</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <h6 class="fw-bold" id="modalMeetingTitle">Meeting Title</h6>
          </div>
          <hr>
          <div class="mb-2">
            <strong id="modalCaseTitle">Case:</strong>
          </div>
          <div class="mb-2">
            <strong id="modalScheduledTime">Scheduled:</strong>
          </div>
          <div class="mb-2">
            <strong id="modalMeetingType">Type:</strong>
          </div>
          <div class="mb-2">
            <strong id="modalDuration">Duration:</strong>
          </div>
          <div class="mb-2">
            <strong id="modalOrganizer">Organized by:</strong>
          </div>
          <div class="mb-2">
            <strong id="modalParticipants">Participants:</strong>
          </div>
          <hr>
          <div class="mb-3">
            <h6 class="fw-bold">Description</h6>
            <p id="modalDescription" class="text-muted"></p>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}