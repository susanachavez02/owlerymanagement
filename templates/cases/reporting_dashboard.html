{% extends "base.html" %}

{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Firm Reports Dashboard</h2>
    <div>
      <a href="{% url 'user-list' %}" class="btn btn-info">Manage Users</a>
    </div>
    <a href="{% url 'cases:case-list' %}" class="btn btn-secondary">Back to Case List</a>
  </div>
  
  <h4>Financial Summary</h4>
  <div class="row">
    <div class="col-md-3">
      <div class="card text-white bg-success mb-3">
        <div class="card-header">Total Paid</div>
        <div class="card-body">
          <h4 class="card-title">${{ total_paid|floatformat:2 }}</h4>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-white bg-danger mb-3">
        <div class="card-header">Outstanding Balance</div>
        <div class="card-body">
          <h4 class="card-title">${{ outstanding_balance|floatformat:2 }}</h4>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-dark bg-light mb-3">
        <div class="card-header">Total Billed</div>
        <div class="card-body">
          <h4 class="card-title">${{ total_billed|floatformat:2 }}</h4>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-dark bg-info mb-3">
        <div class="card-header">Total Hours Logged</div>
        <div class="card-body">
          <h4 class="card-title">{{ total_hours_logged|floatformat:2 }} hrs</h4>
        </div>
      </div>
    </div>
  </div>

  <hr>

  <h4>Attorney Caseloads</h4>
  <table class="table table-striped">
    <thead class="table-light">
      <tr>
        <th scope="col">Attorney Name</th>
        <th scope="col">Username</th>
        <th scope="col">Active Case Count</th>
      </tr>
    </thead>
    <tbody>
      {% for attorney in attorney_caseloads %}
      <tr>
        <td>{{ attorney.get_full_name|default:"-" }}</td>
        <td>{{ attorney.username }}</td>
        <td>{{ attorney.active_case_count }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="3" class="text-center">No attorneys found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <hr>

  <h4>Case Stage Bottlenecks</h4>
  <p>Average time cases spend in each completed stage.</p>
  <table class="table table-striped">
    <thead class="table-light">
      <tr>
        <th scope="col">Stage Name</th>
        <th scope="col">Average Duration (Days, Hours)</th>
      </tr>
    </thead>
    <tbody>
      {% for stage in stage_bottlenecks %}
      <tr>
        <td><strong>{{ stage.stage__name }}</strong></td>
        <td>{{ stage.avg_duration }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="2" class="text-center">No completed case stages found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

{% endblock %}