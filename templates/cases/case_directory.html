{% extends "base.html" %}

{% block content %}
<style>
  /* Page polish (theme-aware via your base CSS variables) */
  .directory-shell {
    border: 1px solid var(--border-color);
    border-radius: 16px;
    overflow: hidden;
  }

  .directory-header {
    background: linear-gradient(135deg, rgba(196,162,76,0.14), rgba(59,130,246,0.10));
    border-bottom: 1px solid var(--border-color);
  }
  :root[data-theme="dark"] .directory-header {
    background: linear-gradient(135deg, rgba(196,162,76,0.14), rgba(59,130,246,0.14));
  }

  .search-wrap .input-group-text {
    border-color: var(--border-color) !important;
    background-color: var(--bg-input) !important;
    color: var(--text-muted) !important;
  }
  .search-wrap .form-control {
    border-color: var(--border-color) !important;
  }

  .table thead th {
    font-weight: 700;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: .02em;
    color: var(--text-muted) !important;
  }

  .case-sub {
    font-size: .85rem;
    color: var(--text-muted);
  }

  .avatar {
    width: 32px;
    height: 32px;
    border-radius: 999px;
    border: 1px solid var(--border-color);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: .75rem;
    color: var(--text-muted);
    background: rgba(148,163,184,0.10);
    box-shadow: var(--shadow-sm, 0 4px 10px rgba(2, 6, 23, 0.08));
  }
</style>

<div class="container-fluid px-0">

  <div class="directory-shell card shadow-sm border-0">

    <div class="directory-header p-4 p-md-5">
      <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">
        <div>
          <h2 class="fw-bold mb-2">Case Directory</h2>
          <p class="text-muted mb-0">View the history of current and past legal cases.</p>
        </div>

        <form method="GET" class="search-wrap" style="min-width: 320px;">
          <div class="input-group">
            <span class="input-group-text border-end-0">
              <i class="fas fa-search"></i>
            </span>

            <input
              type="text"
              name="q"
              class="form-control border-start-0 ps-0"
              placeholder="Search title, attorney, client, status..."
              value="{{ search_query }}"
              aria-label="Search cases"
            >

            <button class="btn btn-primary-action" type="submit">
              Search
            </button>

            {% if search_query %}
              <a href="{% url 'cases:case-directory' %}" class="btn btn-outline-secondary" title="Clear search" aria-label="Clear search">
                <i class="fas fa-times"></i>
              </a>
            {% endif %}
          </div>

          {% if search_query %}
            <small class="text-muted d-block mt-2">
              Showing results for: <strong>{{ search_query }}</strong>
            </small>
          {% endif %}
        </form>
      </div>
    </div>

    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0" id="caseTable">
          <thead class="bg-light">
            <tr>
              <th class="ps-4">Case</th>
              <th>Status</th>
              <th>Stage</th>
              <th>Team</th>
              <th>Filed</th>
              <th class="text-end pe-4">Actions</th>
            </tr>
          </thead>

          <tbody>
            {% for case in cases %}
            <tr>
              <td class="ps-4">
                <a href="{% url 'cases:case-detail' pk=case.pk %}" class="fw-bold text-decoration-none">
                  {{ case.case_title }}
                </a>
                {% if case.case_number %}
                  <div class="case-sub">Case #{{ case.case_number }}</div>
                {% endif %}
              </td>

              <td>
                {% if case.is_archived %}
                  <span class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary">
                    Archived
                  </span>
                {% else %}
                  <span class="badge bg-success bg-opacity-10 text-success border border-success">
                    Active
                  </span>
                {% endif %}
              </td>

              <td>
                {% if case.current_stage %}
                  <span class="badge bg-info bg-opacity-10 text-info border border-info">
                    {{ case.current_stage.name }}
                  </span>
                {% else %}
                  <span class="text-muted small">—</span>
                {% endif %}
              </td>

              <td>
                <div class="d-flex align-items-center flex-wrap gap-1">
                  {% for assignment in case.assignments.all %}
                    <div
                      class="avatar"
                      title="{{ assignment.user.get_full_name }}{% if assignment.user.roles.first %} ({{ assignment.user.roles.first.name }}){% endif %}"
                    >
                      {{ assignment.user.first_name|first }}{{ assignment.user.last_name|first }}
                    </div>
                  {% empty %}
                    <span class="text-muted small">—</span>
                  {% endfor %}
                </div>
              </td>

              <td class="text-muted">
                {{ case.date_filed|date:"M d, Y" }}
              </td>

              <td class="text-end pe-4">
                <a href="{% url 'cases:case-detail' pk=case.pk %}" class="btn btn-sm btn-outline-secondary">
                  View
                </a>
              </td>
            </tr>

            {% empty %}
            <tr>
              <td colspan="6" class="text-center py-5 text-muted">
                <i class="far fa-folder-open fa-3x mb-3 opacity-50"></i>
                <p class="mb-0">No cases found in the directory.</p>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>

{% endblock %}
